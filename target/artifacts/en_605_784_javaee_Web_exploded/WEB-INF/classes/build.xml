<?xml version="1.0" encoding="ISO-8859-1"?>
<project name="webapp-jsp-expression" default="all" basedir=".">

  <!-- set global properties for this build -->
  <property environment="env"/>
  <property file="./examples.properties"/>
  <property name="build.compiler" value="${compiler}"/>
  <property name="source" value="${basedir}"/>
	<property name="bean.ear" value="jspExpressionEar"/>
  <property name="dist" value="${source}/${bean.ear}"/>
  <property name="war.name" value="jspExpressionWar"/>
  <property name="package" value="examples/webapp/jsp/expression"/>

  <typedef resource="weblogic/ant/taskdefs/antlib.xml"/>

  <target name="all" depends="build, deploy"/>

  <target name="build" depends="clean,
                                prepare.example,
                                build.ear
                                "/>

  <target name="clean">
    <delete dir="${dist}" failonerror="false"/>
    <delete dir="${examples.build.dir}/${bean.ear}" failonerror="false"/>
  </target>

  <!-- prepare directories for split directory deployment -->
  <target name="prepare.example"
    description="Prepare the example for compilation and deployment.">
    <mkdir dir="${dist}"/>
    <mkdir dir="${dist}/META-INF"/>
    <mkdir dir="${dist}/${war.name}"/>
    <mkdir dir="${dist}/${war.name}/WEB-INF"/>
    <mkdir dir="${dist}/${war.name}/WEB-INF/tlds"/>
    <mkdir dir="${dist}/${war.name}/WEB-INF/lib"/>
    <mkdir dir="${dist}/${war.name}/images"/>
    <antcall target="copy.files"/>
  </target>

  <!-- copy files for split directory deployment -->
  <target name="copy.files"
    description="Copy example files to distribution structure.">
    <copy todir="${dist}/META-INF">
      <fileset dir="${source}">
        <include name="*application.xml"/>
      </fileset>
    </copy>
    <copy todir="${dist}/${war.name}">
      <fileset dir="${source}">
        <include name="*.jsp"/>
      </fileset>
      <fileset dir="${examples.src.dir}/examples/common/base/webapp">
        <include name="ExamplesFooter.jsp"/>
        <include name="ExamplesHeader.jsp"/>
        <include name="wls_examples.css"/>
      </fileset>
    </copy>
    <copy todir="${dist}/${war.name}/images">
      <fileset dir="${examples.src.dir}/examples/images">
        <include name="oracle_logo.gif"/>
      </fileset>
    </copy>
    <copy todir="${dist}/${war.name}/WEB-INF/src/${package}">
      <fileset dir="${source}">
        <include name="*.java"/>
      </fileset>
    </copy>
    <copy todir="${dist}/${war.name}/WEB-INF/lib">
      <fileset dir="${source}">
        <include name="*.jar"/>
      </fileset>
    </copy>
    <copy file="${source}/weblogic.xml" todir="${dist}/${war.name}/WEB-INF"/>
    <copy file="${source}/web.xml" todir="${dist}/${war.name}/WEB-INF"/>
    <copy file="${source}/exprTag.tld" todir="${dist}/${war.name}/WEB-INF/tlds"/>
  </target>

  <!-- compile EAR for split directory deployment -->
  <target name="build.ear">
    <wlcompile srcdir="${dist}" destdir="${examples.build.dir}/${bean.ear}"
               includes="${war.name}">
      <javac deprecation="${deprecation}" />
      <javac debug="${debug}" debugLevel="${debugLevel}" />
    </wlcompile>
    <wlappc source="${examples.build.dir}/${bean.ear}"
      debug="${debug}" deprecation="${deprecation}"/>
  </target>

  <!-- deploy split directory application -->
  <target name="deploy"
    description="Deploy ear to WebLogic on ${wls.hostname}:${wls.port}.">
    <wldeploy
      user="${wls.username}"
      password="${wls.password}"
      adminurl="t3://${wls.hostname}:${wls.port}"
      action="deploy"
      name="${bean.ear}"
      source="${examples.build.dir}/${bean.ear}"
      failonerror="${failondeploy}"/>
  </target>

    <!-- package the application a J2EE formatted exploded ear -->
  <target name="package.exploded.ear">
    <wlpackage srcdir="${dist}" destdir="${examples.build.dir}/${bean.ear}"
      toDir="${dist}" />
  </target>

  <!-- run the example -->
  <target name="run" description="Run example.">
    <openbrowser failonerror="${failonrun}"
      url="http://${wls.hostname}:${wls.port}/jsp_expr/Expressions.jsp"/>
  </target>

</project>
